<!DOCTYPE html>
<html>
<head>
    <title>Socket Debug Test</title>
    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
</head>
<body>
    <h1>Socket.io Debug Test</h1>
    <button onclick="testConnection()">Test Connection</button>
    <button onclick="sendTestMessage()">Send Test Message</button>
    <div id="log"></div>

    <script>
        let socket = null;
        const log = document.getElementById('log');

        function logMessage(message) {
            console.log(message);
            const div = document.createElement('div');
            div.textContent = new Date().toISOString() + ': ' + message;
            log.appendChild(div);
        }

        function testConnection() {
            socket = io('https://api.daleelbalady.com');
            
            socket.on('connect', () => {
                logMessage('âœ… Connected to socket');
                logMessage('Socket ID: ' + socket.id);
            });

            socket.on('disconnect', () => {
                logMessage('âŒ Disconnected from socket');
            });

            socket.onAny((eventName, ...args) => {
                logMessage('ğŸ”” Event received: ' + eventName);
                logMessage('Data: ' + JSON.stringify(args, null, 2));
            });

            socket.on('multi_search_results', (data) => {
                logMessage('ğŸ” multi_search_results received!');
                logMessage('Data: ' + JSON.stringify(data, null, 2));
            });

            socket.on('search_results', (data) => {
                logMessage('ğŸ“¨ search_results received!');
                logMessage('Data: ' + JSON.stringify(data, null, 2));
            });

            socket.on('ai_message', (data) => {
                logMessage('ğŸ’¬ ai_message received!');
                logMessage('Data: ' + JSON.stringify(data, null, 2));
            });
        }

        function sendTestMessage() {
            if (socket) {
                logMessage('ğŸ“¤ Sending test message...');
                socket.emit('user_message', {
                    message: 'Ø¹Ø§ÙŠØ² Ø·Ø¨ÙŠØ¨ Ø¬Ø±Ø§Ø­',
                    userLocation: { lat: 30.0444, lon: 31.2357 }
                });
            } else {
                logMessage('âŒ Socket not connected');
            }
        }
    </script>
</body>
</html>
